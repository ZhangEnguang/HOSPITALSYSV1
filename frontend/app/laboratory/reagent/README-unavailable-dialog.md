# 试剂不可申领弹框功能

## 功能概述

试剂管理模块实现了智能不可申领弹框功能，当用户尝试申领无库存或已过期的试剂时，系统会显示专门的不可申领弹框，提供详细的原因说明、试剂信息展示和AI智能推荐替代试剂功能。

## 功能特性

### 1. 智能判断机制
- **过期检测**：自动检测试剂是否已过期
- **库存检测**：自动检测试剂库存是否为零
- **状态检测**：检查试剂状态是否为"已过期"或"缺货"
- **综合判断**：多重条件综合判断试剂是否可申领

### 2. 不可申领原因分类
- **试剂已过期且无库存**：最严重情况，需要采购新试剂
- **试剂已过期**：有库存但已过期，安全考虑禁止申领
- **试剂库存不足**：有效期内但无库存，需要补充库存
- **其他原因**：其他导致不可申领的情况

### 3. 详细信息展示
- **试剂基本信息**：名称、英文名、规格、危险等级
- **化学信息**：分子式、CAS号、存储条件
- **状态信息**：有效期、库存量、所属部门、存放位置
- **安全标识**：危险等级标签和安全警告

### 4. AI智能推荐系统
基于多维度分析推荐替代试剂：

#### 推荐算法
1. **同类别优先**：优先推荐相同类别的试剂
2. **化学相似性**：基于分子式元素组成的相似性分析
3. **用途相似性**：基于描述关键词的用途匹配
4. **可用性筛选**：只推荐有库存且未过期的试剂

#### 推荐展示
- **试剂卡片**：显示推荐试剂的基本信息
- **库存状态**：实时显示可用库存量
- **快速申领**：一键跳转到推荐试剂的申领页面
- **推荐说明**：基于AI分析的推荐理由

### 5. 管理员联系功能
- **联系信息**：显示试剂管理员的详细联系方式
- **快速联系**：支持一键拨打电话或发送邮件
- **部门信息**：显示管理员所属部门

## 技术实现

### 组件结构
```
ReagentUnavailableDialog
├── 弹框头部 (原因图标 + 标题)
├── 试剂信息卡片 (详细信息展示)
├── 左侧面板
│   ├── 不可申领原因说明
│   ├── 试剂详细信息
│   └── 管理员联系方式
└── 右侧面板 (AI推荐替代试剂)
    ├── 推荐算法说明
    ├── 推荐试剂列表
    └── 快速申领按钮
```

### 核心逻辑
```typescript
// 判断试剂是否可申领
const canApply = (reagent: any) => {
  const today = new Date()
  const expiryDate = new Date(reagent.expiryDate)
  const isExpired = expiryDate < today || reagent.status === "已过期"
  const isOutOfStock = reagent.currentAmount <= 0 || reagent.status === "缺货"
  
  return !isExpired && !isOutOfStock
}

// 获取不可申领原因
const getUnavailableReason = (reagent: any) => {
  // 多重条件判断，返回具体原因和建议
}

// AI推荐算法
const getRecommendedReagents = (reagent: any) => {
  // 1. 同类别试剂推荐
  // 2. 化学相似性分析
  // 3. 用途相似性匹配
  // 4. 可用性筛选
}
```

### 集成方式
```typescript
// 在试剂页面中的申领处理逻辑
const handleOpenApplyDialog = (reagent: any) => {
  if (!canApply(reagent)) {
    // 显示不可申领弹框
    setSelectedReagentForUnavailable(reagent)
    setUnavailableDialogOpen(true)
    return
  }
  
  // 显示正常申领弹框
  setSelectedReagentForApply(reagent)
  setApplyDialogOpen(true)
}
```

## 使用场景

### 1. 安全管理
- **过期试剂控制**：防止使用过期试剂影响实验结果
- **安全风险提示**：显示危险等级和安全注意事项
- **规范操作流程**：引导用户按规范申领试剂

### 2. 库存管理
- **缺货提醒**：及时提醒管理员补充库存
- **替代方案**：提供可用的替代试剂选择
- **采购建议**：为采购计划提供数据支持

### 3. 实验效率
- **快速替代**：AI推荐减少人工查找时间
- **一键申领**：简化替代试剂的申领流程
- **信息透明**：提供完整的试剂状态信息

### 4. 管理协调
- **联系渠道**：提供管理员直接联系方式
- **问题反馈**：支持紧急情况下的快速沟通
- **流程优化**：收集用户反馈优化管理流程

## 用户体验设计

### 1. 视觉设计
- **状态色彩**：不同严重程度使用不同颜色标识
- **图标语言**：直观的图标表达不同状态
- **信息层次**：清晰的信息架构和视觉层次

### 2. 交互设计
- **渐进式加载**：AI推荐结果的动态加载效果
- **悬停反馈**：丰富的鼠标悬停交互反馈
- **快捷操作**：一键联系和快速申领功能

### 3. 响应式设计
- **自适应布局**：支持不同屏幕尺寸的自适应显示
- **移动端优化**：针对移动设备的交互优化
- **无障碍支持**：支持键盘导航和屏幕阅读器

## 最佳实践

### 1. 管理员配置
- **及时更新联系信息**：确保管理员信息的准确性
- **定期检查库存**：主动补充缺货试剂
- **关注过期提醒**：及时处理即将过期的试剂

### 2. 用户使用
- **查看推荐理由**：了解AI推荐的依据
- **确认替代可行性**：验证推荐试剂是否适用
- **及时反馈问题**：向管理员反馈使用中的问题

### 3. 系统维护
- **数据准确性**：确保试剂信息的实时更新
- **推荐算法优化**：根据使用反馈优化推荐算法
- **性能监控**：监控弹框加载和推荐生成性能

## 更新日志

- **v1.0.0**：实现基础不可申领弹框功能
- 支持过期和缺货检测
- 实现AI智能推荐算法
- 添加管理员联系功能
- 完善用户体验设计
- 提供完整的技术文档 