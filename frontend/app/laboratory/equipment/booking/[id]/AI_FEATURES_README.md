# 仪器预约系统 AI 智能功能说明

## 🚀 新增AI功能概览

为了提升用户预约体验，我们在仪器预约页面集成了多项AI智能功能：

### 1. 智能预约推荐 🧠

#### 最佳时间推荐
- **功能描述**：基于历史使用数据分析，AI自动推荐空闲率高的时间段
- **推荐算法**：
  - 分析过去的使用模式和频率
  - 计算不同时间段的空闲率
  - 根据用户偏好调整推荐分数
- **交互方式**：
  - 点击"显示推荐"按钮查看AI推荐
  - 每个推荐显示推荐度、原因说明
  - 一键应用推荐时间段

#### 冲突检测
- **时间重叠检测**：自动识别选择的时间段是否有重叠
- **背靠背预约提醒**：连续使用时间过长时给出建议
- **单日过载警告**：一天使用超过6小时时进行提醒
- **智能建议**：为每种冲突类型提供解决方案

#### 使用时长建议
- **基于实验类型**：根据不同实验类型推荐典型时长
- **个人历史分析**：基于用户过往使用记录给出建议
- **设备平均时长**：参考该设备的平均使用时间
- **时长范围**：提供最小-最大时长范围参考

### 2. 智能表单助手 ✨

#### 实验目的自动补全
- **智能匹配**：根据设备类型匹配相关实验目的
- **模糊搜索**：支持部分输入自动补全
- **置信度评分**：每个建议显示匹配置信度
- **历史记录**：优先推荐用户常用的实验目的
- **相关信息**：显示预计时长、相关项目等

#### 项目关联建议
- **设备匹配**：推荐使用过相同设备的项目
- **关键词分析**：基于实验目的匹配项目名称
- **团队信息**：显示项目团队成员
- **项目状态**：优先推荐进行中的项目
- **相关性评分**：显示项目匹配度

#### 样品信息助手
- **信息模板**：根据设备类型提供样品信息模板
- **必填提醒**：明确标注必填的样品信息
- **注意事项**：提供设备相关的样品准备要点
- **一键应用**：快速在备注中插入样品信息模板

### 3. 数据可视化 📊

#### 使用率热力图
- **时间维度**：显示一周内不同时间段的使用情况
- **颜色编码**：绿色(低) → 黄色(中) → 橙色(高) → 红色(极高)
- **交互提示**：鼠标悬停显示具体使用率数据
- **预约参考**：帮助用户选择空闲时段

## 🔧 技术实现

### 文件结构
```
app/laboratory/equipment/booking/[id]/
├── page.tsx                     # 主预约页面
├── ai-recommendation.ts         # AI推荐核心逻辑
├── smart-form-assistant.ts      # 智能表单助手
└── AI_FEATURES_README.md        # 功能说明文档
```

### 核心算法

1. **时间推荐算法**：
   - 空闲率计算：`1 - (使用次数 / 最大使用次数)`
   - 用户偏好加权：偏好时段 +20分，避免时段 -30分
   - 项目优先级：进行中项目 +10分

2. **智能匹配算法**：
   - 精确匹配：置信度 100%
   - 包含匹配：置信度 90%
   - 部分匹配：置信度 80%
   - 历史加权：+10%置信度

3. **冲突检测逻辑**：
   - 时间重叠：检查start1 < end2 && start2 < end1
   - 连续使用：检查相邻时段间隔 = 0
   - 使用过载：检查单日总时长 > 6小时

### 数据模型

```typescript
// 时间推荐
interface TimeRecommendation {
  date: Date
  startTime: string
  endTime: string
  score: number
  reason: string
  conflictLevel: 'none' | 'low' | 'medium' | 'high'
  historicalUsage: number
}

// 实验建议
interface ExperimentSuggestion {
  text: string
  category: string
  confidence: number
  relatedProjects: string[]
  estimatedDuration: number
}

// 项目建议
interface ProjectSuggestion {
  id: string
  name: string
  category: string
  relevanceScore: number
  reason: string
  team: string[]
}
```

## 🎯 使用指南

### 用户操作流程

1. **查看智能推荐**
   - 进入预约页面后，点击"显示推荐"
   - 查看AI推荐的最佳时间段
   - 点击"应用"按钮快速选择推荐时间

2. **使用表单助手**
   - 在"使用目的"字段输入关键词
   - 从AI推荐列表中选择合适的实验目的
   - 在"项目"字段查看自动关联的项目建议
   - 使用样品信息模板填写备注

3. **参考数据可视化**
   - 查看使用率热力图了解设备使用情况
   - 选择颜色较浅（使用率低）的时间段
   - 参考冲突检测提示调整预约安排

### 提示信息说明

- 🟢 **绿色提示**：正常状态，推荐操作
- 🟡 **黄色警告**：需要注意，建议调整
- 🟠 **橙色警告**：存在问题，需要处理
- 🔴 **红色错误**：严重冲突，必须解决

## 🔮 未来扩展

### 计划中的功能

1. **深度学习优化**
   - 用户行为模式学习
   - 个性化推荐算法
   - 动态权重调整

2. **更多AI助手**
   - 智能排队系统
   - 设备状态预测
   - 实验结果分析

3. **集成外部数据**
   - 天气影响分析
   - 实验室环境监测
   - 设备维护预测

### 性能优化

- 缓存推荐结果
- 异步加载AI建议
- 增量数据更新
- 响应式设计优化

## 📝 开发说明

### 添加新的实验类型
在 `smart-form-assistant.ts` 中的 `experimentPurposes` 数组添加新类型：

```typescript
{
  category: "新设备类型",
  purposes: [
    "实验目的1",
    "实验目的2",
    // ...
  ]
}
```

### 添加新的样品模板
在 `sampleTemplates` 对象中添加新模板：

```typescript
"新设备类型": {
  requiredInfo: ["必填字段1", "必填字段2"],
  optionalInfo: ["可选字段1", "可选字段2"],
  tips: ["注意事项1", "注意事项2"]
}
```

### 调整推荐算法
在 `ai-recommendation.ts` 中修改 `getBestTimeRecommendations` 函数的评分逻辑。

---

*本功能持续优化中，如有问题或建议请联系开发团队。* 