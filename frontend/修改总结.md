# 会议审查分配页面代码适配修改总结

## 修改概述
完成了项目概要页签（overview-tab.tsx）和送审文件页签（review-files-tab.tsx）的代码适配，移除了硬编码内容，使组件能够动态响应project数据的变化。

## 1. 项目概要页签（overview-tab.tsx）修改

### AI摘要区域优化
- **移除硬编码AI内容**：不再根据项目类型硬编码AI摘要和建议
- **动态生成摘要**：基于项目实际数据（进度、预算、使用率等）生成AI摘要
- **智能建议系统**：根据项目状态、类型、进度等因素动态生成相关建议
- **评分系统优化**：基于项目实际数据计算进度评分、风险评分等

### 基本信息部分
- **项目类型适配**：支持"动物实验"、"人体试验"等不同项目类型
- **动态字段显示**：根据项目类型显示不同的相关字段
- **数据来源多样化**：支持多种数据字段名称（如leader.name、leader等）
- **默认值处理**：使用"未设置"替代硬编码的虚假数据

### 研究者信息
- **联系方式优化**：支持多种数据结构获取研究者信息
- **团队成员展示**：优化团队成员卡片展示，支持多彩头像和完整信息显示

## 2. 送审文件页签（review-files-tab.tsx）修改

### 文件数据处理
- **动态文件生成**：改进`generateProjectFiles`函数，支持多种文件数据结构
- **状态映射优化**：新增`getFileStatus`函数，统一处理各种状态表示
- **审核意见智能化**：`getDefaultReviewComments`根据文件状态生成合适的默认意见
- **文件描述生成**：`getDefaultFileDescription`基于文件类型和项目类型生成描述

### 用户界面适配
- **描述动态化**：页面描述根据`project.reviewType`动态调整
- **空状态优化**：空文件列表提示信息动态化
- **文件详情对话框**：审查类型信息动态获取

### 文件上传优化
- **上传者信息**：支持多种数据结构获取上传者姓名
- **默认描述**：自动生成文件描述，减少用户输入负担

## 3. 数据结构支持

### 项目对象支持的字段
```typescript
project?: {
  // 基本信息
  title?: string
  name?: string
  projectNumber?: string
  reviewNumber?: string
  projectType?: string
  status?: string
  description?: string
  
  // 时间和预算
  startDate?: string
  endDate?: string
  budget?: number
  budgetUsed?: number
  progress?: number
  
  // 研究者信息
  leader?: {
    name?: string
    title?: string
    email?: string
    phone?: string
    department?: string
    address?: string
  } | string
  department?: string
  contactEmail?: string
  contactPhone?: string
  
  // 项目类型相关
  animalType?: string
  animalCount?: number
  facilityUnit?: string
  studyType?: string
  participantCount?: number
  researchUnit?: string
  
  // AI分析数据
  aiAnalysis?: {
    summary?: string
    modelName?: string
    modelVersion?: string
    suggestions?: string[]
    confidence?: number
    updatedAt?: string
  }
  
  // 分析评分
  analysis?: {
    progressScore?: string
    riskScore?: string
    achievementScore?: string
  }
  
  // 文件相关
  files?: Array<{
    id?: string
    name?: string
    fileName?: string
    type?: string
    fileType?: string
    size?: string
    fileSize?: string
    status?: string
    uploadedAt?: string
    uploadDate?: string
    uploadUser?: string
    reviewComments?: string
    reviewDate?: string
    description?: string
    version?: string
  }>
  
  // 审查相关
  reviewType?: string
  riskLevel?: string
  
  // 团队成员
  members?: Array<{
    name?: string
    title?: string
    role?: string
    department?: string
    email?: string
    phone?: string
  }>
}
```

## 4. 主要改进点

### 代码健壮性
- 使用可选链操作符（?.）避免undefined错误
- 提供合理的默认值，避免显示"undefined"
- 支持多种数据字段名称，提高兼容性

### 用户体验
- 动态内容生成，更贴近实际项目情况
- 智能化的AI建议和评分系统
- 清晰的"未设置"提示，指导用户完善信息

### 可维护性
- 抽取通用函数处理数据转换
- 模块化的状态处理逻辑
- 统一的默认值处理策略

## 5. 使用说明

这两个组件现在完全依赖传入的`project`对象来显示数据。确保传入的project对象包含必要的字段，组件会自动处理数据展示和默认值显示。

对于缺失的数据，组件会显示"未设置"等提示信息，引导用户完善项目信息。

## 6. 团队成员卡片功能详解

项目团队成员卡片现在包含以下特性：

### 视觉设计
- **多彩头像**：每个成员使用不同颜色的渐变头像，增强视觉区分度
- **响应式布局**：在不同屏幕尺寸下自适应显示（手机1列、平板2列、桌面4列）
- **悬停效果**：卡片有优雅的悬停阴影效果

### 信息展示
- **基本信息**：姓名、职位/角色、部门
- **联系方式**：邮箱和电话（可点击直接联系）
- **空状态处理**：当没有团队成员时显示友好的提示信息

### 数据兼容性
支持以下团队成员数据结构：
```typescript
members?: Array<{
  name?: string          // 成员姓名
  title?: string         // 职位
  role?: string          // 角色（作为title的备选）
  department?: string    // 所属部门
  email?: string         // 邮箱地址
  phone?: string         // 联系电话
}>
```

## 7. 新增功能：指派独立顾问

为会议审查模块新增了指派独立顾问的功能：

### 功能特性
- **按钮位置**：在会议审查列表页面的每个项目卡片中，位于"分配主审委员"按钮下方
- **对话框界面**：点击按钮后弹出专业的独立顾问指派对话框
- **顾问选择**：支持搜索、排序、分页浏览独立顾问
- **咨询内容**：可自定义需要顾问关注的具体伦理问题

### 技术实现
- **配置文件修改**：`meeting-review-config.tsx` 新增指派独立顾问按钮配置
- **主页面集成**：`page.tsx` 集成AssignAdvisorDialog组件和相关状态管理
- **对话框组件**：使用现有的`assign-advisor-dialog.tsx`组件

### 用户体验
- **一键指派**：从项目列表直接发起独立顾问指派
- **智能推荐**：顾问按匹配度排序，便于选择合适的专家
- **状态反馈**：完整的成功/失败反馈机制

### 修改的文件
1. `app/ethic-review/meeting-review/config/meeting-review-config.tsx` - 添加指派独立顾问按钮配置
2. `app/ethic-review/meeting-review/page.tsx` - 集成对话框组件和处理逻辑

### 实现细节
- 在cardActions配置中新增"assignAdvisor"操作
- 在主页面中自定义cardActions，覆盖点击处理函数
- **新增表格列自定义**：创建customTableColumns覆盖操作列，在表格操作下拉菜单中添加"指派独立顾问"选项
- 使用useState管理对话框显示状态和选中项目
- 通过props传递项目信息到AssignAdvisorDialog组件

### 表格和卡片视图兼容
- **卡片视图**：通过customCardActions在操作按钮中显示"指派独立顾问"
- **表格视图**：通过customTableColumns在操作下拉菜单中显示"指派独立顾问"
- 两种视图下点击都会触发同一个handleAssignAdvisor函数，打开对话框

### 代码修改要点
1. `cardActions`配置 - 为卡片视图添加按钮
2. `customCardActions`函数 - 覆盖按钮点击事件
3. `customTableColumns`函数 - 为表格视图添加操作菜单项
4. 事件处理函数统一 - 无论哪种视图都调用相同的处理函数